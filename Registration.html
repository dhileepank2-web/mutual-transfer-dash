<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mutual Transfer | Registration</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; }
  .input { border: 1.5px solid #e2e8f0; border-radius: 1rem; padding: 1rem; width: 100%; transition: 0.2s; }
  .input:focus { border-color: #2563eb; outline: none; box-shadow: 0 0 0 4px rgba(37,99,235,0.1); }
  .segment { border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.75rem; flex: 1; font-weight: 600; text-align: center; cursor: pointer; }
  .segment.active { background: #1e293b; color: white; border-color: #1e293b; }
  .mandatory::after { content: " *"; color: #ef4444; }
</style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

<div id="loader" class="hidden fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-2xl shadow-xl text-center">
    <div class="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"></div>
    <p class="mt-4 font-bold">Registering Profile...</p>
  </div>
</div>

<div class="bg-white w-full max-w-2xl rounded-[2rem] shadow-xl p-8 border border-slate-100">
  <header class="mb-8">
    <h1 class="text-3xl font-extrabold text-slate-900">Create Account</h1>
    <p class="text-slate-500">Join the mutual transfer network instantly.</p>
  </header>

  <form id="regForm" class="space-y-6" onsubmit="event.preventDefault(); submitForm();">
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label class="mandatory text-xs font-bold uppercase text-slate-400">Full Name</label>
        <input id="name" type="text" required class="input mt-2" placeholder="Your Name">
      </div>
      <div>
        <label class="mandatory text-xs font-bold uppercase text-slate-400">Joining Date</label>
        <input id="doj" type="date" required class="input mt-2">
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label class="mandatory text-xs font-bold uppercase text-slate-400">Designation</label>
        <select id="designation" required class="input mt-2 appearance-none">
          <option value="">Select Role</option>
          <option>Assistant</option><option>Junior Assistant</option><option>Typist</option>
          <option>Steno Typist</option><option>Office Assistant</option>
        </select>
      </div>
      <div>
        <label class="mandatory text-xs font-bold uppercase text-slate-400">WhatsApp Number</label>
        <input id="phone" maxlength="10" required class="input mt-2" placeholder="10-digit mobile" oninput="livePhoneCheck(this)">
        <p id="phoneStatus" class="text-[10px] font-bold mt-1 hidden"></p>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label class="mandatory text-xs font-bold uppercase text-slate-400">Working District</label>
        <select id="workingDistrict" required class="input mt-2"><option>Loading...</option></select>
      </div>
      <div>
        <label class="mandatory text-xs font-bold uppercase text-slate-400">Willing District</label>
        <select id="willingDistrict" required class="input mt-2"><option>Loading...</option></select>
      </div>
    </div>

    <div>
      <label class="mandatory text-xs font-bold uppercase text-slate-400">Official Email</label>
      <input id="email" type="email" required class="input mt-2" placeholder="email@example.com">
    </div>

    <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold text-lg shadow-lg shadow-blue-100 transition-all">
      Register Now
    </button>
  </form>
</div>

<script>
const SCRIPT_URL="YOUR_SCRIPT_URL_HERE";
let isMobileUnique = false;

function livePhoneCheck(input) {
  input.value = input.value.replace(/[^0-9]/g, '');
  if(input.value.length === 10) {
    document.getElementById('phoneStatus').classList.remove('hidden');
    document.getElementById('phoneStatus').innerText = "Checking...";
    fetch(`${SCRIPT_URL}?action=checkPhone&phone=${input.value}`)
    .then(r => r.json()).then(res => {
      isMobileUnique = !res.exists;
      document.getElementById('phoneStatus').innerText = isMobileUnique ? "✅ Available" : "❌ Already Registered";
      document.getElementById('phoneStatus').className = isMobileUnique ? "text-[10px] font-bold mt-1 text-green-600" : "text-[10px] font-bold mt-1 text-red-500";
    });
  }
}

window.onload=()=>{
  fetch(`${SCRIPT_URL}?action=getDistricts`).then(r=>r.json()).then(d=>{
    const opt = d.map(x=>`<option value="${x}">${x}</option>`).join('');
    document.getElementById('workingDistrict').innerHTML=opt;
    document.getElementById('willingDistrict').innerHTML=opt;
  });
};

function submitForm() {
  if(!isMobileUnique) return alert("Phone number already registered.");
  document.getElementById('loader').classList.remove("hidden");
  
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "register",
      userData: {
        name: document.getElementById('name').value,
        doj: document.getElementById('doj').value,
        designation: document.getElementById('designation').value,
        phone: document.getElementById('phone').value,
        workingDistrict: document.getElementById('workingDistrict').value,
        willingDistrict: document.getElementById('willingDistrict').value,
        email: document.getElementById('email').value,
        probation: "No", coa: "No" // Default values
      }
    })
  }).then(() => {
    alert("✅ Registration Successful!");
    location.reload();
  });
}
</script>
</body>
</html>
